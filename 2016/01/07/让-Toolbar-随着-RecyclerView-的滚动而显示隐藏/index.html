<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="google-site-verification" content="xBT4GhYoi5qRD5tr338pgPM5OWHHIDR6mNg1a3euekI" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="description">
    <meta name="keywords"  content="Mi&Jack, Mi&Jack Blog, 江湖迈杰的博客, yuanyujie, 袁宇杰, Java, Android">
    <meta name="theme-color" content="#000000">
    
    <title>让 Toolbar 随着 RecyclerView 的滚动而显示/隐藏 - 江湖迈杰的博客 | BY Mi&Jack</title>

    <!-- Web App Manifest -->
    <link rel="manifest" href="/pwa/manifest.json">

    <!-- Favicon -->
    <link rel="shortcut icon" href="/img/favicon.ico">

    <!-- Canonical URL -->
    <link rel="canonical" href="http://localhost:4000/2016/01/07/%E8%AE%A9-Toolbar-%E9%9A%8F%E7%9D%80-RecyclerView-%E7%9A%84%E6%BB%9A%E5%8A%A8%E8%80%8C%E6%98%BE%E7%A4%BA%E9%9A%90%E8%97%8F/">

    <!-- Bootstrap Core CSS -->
    <link rel="stylesheet" href="/css/bootstrap.min.css">

    <!-- Custom CSS -->
    <link rel="stylesheet" href="/css/hux-blog.min.css">

    <!-- Pygments Github CSS -->
    <link rel="stylesheet" href="/css/syntax.css">

    <!-- Custom Fonts -->
    <!-- <link href="http://maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css" rel="stylesheet" type="text/css"> -->
    <!-- Hux change font-awesome CDN to qiniu -->
    <link href="//cdnjs.cloudflare.com/ajax/libs/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" type="text/css">


    <!-- Hux Delete, sad but pending in China
    <link href='http://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic' rel='stylesheet' type='text/css'>
    <link href='http://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800' rel='stylesheet' type='text/
    css'>
    -->


    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

    <!-- ga & ba script hoook -->
    <script></script>
</head>


<!-- hack iOS CSS :active style -->
<body ontouchstart="">

    <!-- Navigation -->
<nav class="navbar navbar-default navbar-custom navbar-fixed-top">
    <div class="container-fluid">
        <!-- Brand and toggle get grouped for better mobile display -->
        <div class="navbar-header page-scroll">
            <button type="button" class="navbar-toggle">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="/">江湖迈杰的博客</a>
        </div>

        <!-- Collect the nav links, forms, and other content for toggling -->
        <div id="huxblog_navbar">
            <div class="navbar-collapse">
                <ul class="nav navbar-nav navbar-right">
                    <li>
                        <a href="/">Home</a>
                    </li>
                    
                    <li>
                        <a href="/about/">About</a>
                    </li>
                    
                    <li>
                        <a href="/tags/">Tags</a>
                    </li>
                    
                </ul>
            </div>
        </div>
        <!-- /.navbar-collapse -->
    </div>
    <!-- /.container -->
</nav>
<script>
    // Drop Bootstarp low-performance Navbar
    // Use customize navbar with high-quality material design animation
    // in high-perf jank-free CSS3 implementation
    var $body   = document.body;
    var $toggle = document.querySelector('.navbar-toggle');
    var $navbar = document.querySelector('#huxblog_navbar');
    var $collapse = document.querySelector('.navbar-collapse');

    var __HuxNav__ = {
        close: function(){
            $navbar.className = " ";
            // wait until animation end.
            setTimeout(function(){
                // prevent frequently toggle
                if($navbar.className.indexOf('in') < 0) {
                    $collapse.style.height = "0px"
                }
            },400)
        },
        open: function(){
            $collapse.style.height = "auto"
            $navbar.className += " in";
        }
    }

    // Bind Event
    $toggle.addEventListener('click', function(e){
        if ($navbar.className.indexOf('in') > 0) {
            __HuxNav__.close()
        }else{
            __HuxNav__.open()
        }
    })

    /**
     * Since Fastclick is used to delegate 'touchstart' globally
     * to hack 300ms delay in iOS by performing a fake 'click',
     * Using 'e.stopPropagation' to stop 'touchstart' event from 
     * $toggle/$collapse will break global delegation.
     * 
     * Instead, we use a 'e.target' filter to prevent handler
     * added to document close HuxNav.  
     *
     * Also, we use 'click' instead of 'touchstart' as compromise
     */
    document.addEventListener('click', function(e){
        if(e.target == $toggle) return;
        if(e.target.className == 'icon-bar') return;
        __HuxNav__.close();
    })
</script>


    <!-- Image to hack wechat -->
<!-- <img src="/img/icon_wechat.png" width="0" height="0"> -->
<!-- <img src="/img/bg-head.jpg" width="0" height="0"> -->

<!-- Post Header -->
<style type="text/css">
    header.intro-header{
        position: relative;
        background-image: url('/img/bg-head.jpg')
    }

    
</style>
<header class="intro-header" >
    <div class="header-mask"></div>
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <div class="post-heading">
                    <div class="tags">
                        
                        <a class="tag" href="/tags/#Android" title="Android">Android</a>
                        
                        <a class="tag" href="/tags/#开发" title="开发">开发</a>
                        
                    </div>
                    <h1>让 Toolbar 随着 RecyclerView 的滚动而显示/隐藏</h1>
                    
                    
                    <h2 class="subheading"></h2>
                    
                    <span class="meta">Posted by Mi&Jack on January 7, 2016</span>
                </div>
            </div>
        </div>
    </div>
</header>

<!-- Post Content -->
<article>
    <div class="container">
        <div class="row">

    <!-- Post Container -->
            <div class="
                col-lg-8 col-lg-offset-2
                col-md-10 col-md-offset-1
                post-container">

				<p>这篇文章是过时的，你应该跳到<a href="https://mzgreen.github.io/2015/06/23/How-to-hideshow-Toolbar-when-list-is-scrolling%28part3%29/">第三部分 3</a>。</p>

<p>在这篇文章中，我们将看到如何实现像Google+ 应用程序一样，当列表下滑时，Toolbar和FAB（包括其他的View）隐藏；当列表上滑时，Toolbar和FAB（包括其他的View）显示的效果；这种效果在<a href="http://android-developers.blogspot.com/2014/10/material-design-on-android-checklist.html">Material Design Checklist</a>提到过.</p>

<blockquote>
  <p>“在一些场景下，当屏幕向上滚动时，app bar将会从屏幕上移除，留出更多的空间供内容。相反，当向上滚动时，app bar应再次显示。</p>
</blockquote>

<p>我们的目标效果如下图所示：</p>

<p><img src="https://mzgreen.github.io/images/1/demo_gif.gif" alt="" /></p>

<p>我们将使用<code class="highlighter-rouge">RecyclerView</code>为我们的List，当然，你也可以选择其他滚动控件（例如<code class="highlighter-rouge"> ListView </code>，但它就意味着更多的编码。现在，我有两种具体的实现方法：</p>

<ol>
  <li>给List设置padding</li>
  <li>给List添加一个headr</li>
</ol>

<p>我只是决定执行第二个方案，因为我发现在如何给<code class="highlighter-rouge">RecyclerView</code>添加header这一问题上，有很多需要注意的地方，这是一个很好的机会去解决他们。
我也将简要描述第一个。</p>

<p>###我们开始吧</p>

<p>我们要创建一个工程，并添加如下依赖：</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    dependencies {
      compile fileTree(dir: 'libs', include: ['*.jar'])
      compile 'com.android.support:appcompat-v7:21.0.3'
      compile "com.android.support:recyclerview-v7:21.0.0"
      compile 'com.android.support:cardview-v7:21.0.3'
    }
</code></pre></div></div>

<p>现在我们应该定义<code class="highlighter-rouge">style.xml</code>，我们的应用程序将使用Material的主题,但我们不使用<code class="highlighter-rouge"> ActionBar </code>（取而代之是<code class="highlighter-rouge">Toolbar</code>）：</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;style name="AppTheme" parent="Theme.AppCompat.Light.NoActionBar"&gt;
  &lt;item name="colorPrimary"&gt;@color/color_primary&lt;/item&gt;
  &lt;item name="colorPrimaryDark"&gt;@color/color_primary_dark&lt;/item&gt;
&lt;/style&gt;
</code></pre></div></div>

<p>接下来是创建<code class="highlighter-rouge">Activity</code>的布局：</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;FrameLayout 
	xmlns:android="http://schemas.android.com/apk/res/android"
    android:layout_width="match_parent"
    android:layout_height="match_parent"&gt;

	&lt;android.support.v7.widget.RecyclerView
    	android:id="@+id/recyclerView"
        android:layout_width="match_parent"
        android:layout_height="match_parent"&gt;

		&lt;android.support.v7.widget.Toolbar
        	android:id="@+id/toolbar"
        	android:layout_width="match_parent"
            android:layout_height="?attr/actionBarSize"
            android:background="?attr/colorPrimary"&gt;

			&lt;ImageButton
                android:id="@+id/fabButton"
                android:layout_width="56dp"
                android:layout_height="56dp"
                android:layout_gravity="bottom|right"
                android:layout_marginbottom="16dp"
                android:layout_marginright="16dp"
                android:background="@drawable/fab_background"
                android:src="@drawable/ic_favorite_outline_white_24dp"
                android:contentdescription="@null"&gt;
            &lt;/ImageButton&gt;
        &lt;/android.support.v7.widget.Toolbar&gt;
    &lt;/android.support.v7.widget.RecyclerView&gt;
&lt;/FrameLayout&gt;
</code></pre></div></div>

<p>这是一个简单的布局，只有<code class="highlighter-rouge">RecyclerView</code>、<code class="highlighter-rouge">Toolbar</code>以及作为FAB的<code class="highlighter-rouge">ImageButton</code>。我们需要把它们放在一个<code class="highlighter-rouge">FrameLayout</code>，因为这样可以达到<code class="highlighter-rouge">Toolbar</code>覆盖<code class="highlighter-rouge"> RecyclerView</code>的效果。如果我们不这样做，当我们隐藏Toolbar的时候在列表的上方将会有一个空白的空间。</p>

<p>让我们来看看<code class="highlighter-rouge">MainActiviy</code>的代码吧：</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>public class MainActivity extends ActionBarActivity {
  private Toolbar mToolbar;
  private ImageButton mFabButton;

  @Override
  protected void onCreate(Bundle savedInstanceState) {
    super.onCreate(savedInstanceState);
    setContentView(R.layout.activity_main);
    initToolbar();
    mFabButton = (ImageButton) findViewById(R.id.fabButton);
    initRecyclerView();
  }

  private void initToolbar() {
    mToolbar = (Toolbar) findViewById(R.id.toolbar);
    setSupportActionBar(mToolbar);
    setTitle(getString(R.string.app_name));
    mToolbar.setTitleTextColor(getResources().getColor(android.R.color.white));
  }

  private void initRecyclerView() {
    RecyclerView recyclerView = (RecyclerView) findViewById(R.id.recyclerView);
    recyclerView.setLayoutManager(new LinearLayoutManager(this));
    RecyclerAdapter recyclerAdapter = new RecyclerAdapter(createItemList());
    recyclerView.setAdapter(recyclerAdapter);
  }

}
</code></pre></div></div>

<p>正如你所看到的，这是一个十分简单的类，它只实现onCreate()方法，做了以下事情：</p>

<ol>
  <li>初始化 <code class="highlighter-rouge">Toolbar</code></li>
  <li>获取FAB</li>
  <li>初始化 <code class="highlighter-rouge">RecyclerView</code></li>
</ol>

<p>现在我们将为<code class="highlighter-rouge">RecylerView</code>创建adapter。在这之前，我们需要添加list item的布局：</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span>
<span class="nt">&lt;android.support.v7.widget.cardview</span>
	<span class="na">xmlns:android=</span><span class="s">"http://schemas.android.com/apk/res/android"</span>
    <span class="na">xmlns:card_view=</span><span class="s">"http://schemas.android.com/apk/res-auto"</span>
    <span class="na">android:layout_width=</span><span class="s">"match_parent"</span>
    <span class="na">android:layout_height=</span><span class="s">"wrap_content"</span>
    <span class="na">android:layout_gravity=</span><span class="s">"center"</span>
    <span class="na">android:layout_margin=</span><span class="s">"8dp"</span>
    <span class="na">card_view:cardcornerradius=</span><span class="s">"4dp"</span><span class="nt">&gt;</span>

    <span class="nt">&lt;TextView</span>
    	<span class="na">android:id=</span><span class="s">"@+id/itemTextView"</span>
    	<span class="na">android:layout_width=</span><span class="s">"match_parent"</span>
        <span class="na">android:layout_height=</span><span class="s">"?attr/listPreferredItemHeight"</span>
        <span class="na">android:gravity=</span><span class="s">"center_vertical"</span>
        <span class="na">android:padding=</span><span class="s">"8dp"</span>
        <span class="na">style=</span><span class="s">"@style/Base.TextAppearance.AppCompat.Body2"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;/TextView&gt;</span>
<span class="nt">&lt;/android.support.v7.widget.cardview&gt;</span>
</code></pre></div></div>

<p>对应的<code class="highlighter-rouge">ViewHolder</code>如下:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>public class RecyclerItemViewHolder extends RecyclerView.ViewHolder {
  private final TextView mItemTextView;

  public RecyclerItemViewHolder(final View parent, TextView itemTextView) {
    super(parent);
    mItemTextView = itemTextView;
  }

  public static RecyclerItemViewHolder newInstance(View parent) {
    TextView itemTextView = (TextView) parent.findViewById(R.id.itemTextView);
    return new RecyclerItemViewHolder(parent, itemTextView);
  }

  public void setItemText(CharSequence text) {
    mItemTextView.setText(text);
  }

}
</code></pre></div></div>
<p>我们的列表用于呈现带有文本的卡片 - 简单吧！</p>

<p>现在，我们看一下<code class="highlighter-rouge">RecyclerAdapter</code>的代码：</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>public class RecyclerAdapter extends RecyclerView.Adapter&lt;recyclerview.viewholder&gt; {
  private List&lt;string&gt; mItemList;

  public RecyclerAdapter(List&lt;string&gt; itemList) {
    mItemList = itemList;
  }

  @Override
  public RecyclerView.ViewHolder onCreateViewHolder(ViewGroup parent, int viewType) {
    final View view = LayoutInflater.from(parent.getContext()).inflate(R.layout.recycler_item, parent, false);
    return RecyclerItemViewHolder.newInstance(view);
  }

  @Override
  public void onBindViewHolder(RecyclerView.ViewHolder viewHolder, int position) {
    RecyclerItemViewHolder holder = (RecyclerItemViewHolder) viewHolder;
    String itemText = mItemList.get(position);
    holder.setItemText(itemText);
  }

  @Override
  public int getItemCount() {
    return mItemList == null ? 0 : mItemList.size();
  }

}
</code></pre></div></div>

<p>这个是<code class="highlighter-rouge">RecyclerView.Adapter</code>的基本实现。并没有什么特殊的东西。如果，你想深入了解 <code class="highlighter-rouge">RecyclerView</code>,我建议你好好的阅读一下Mark Allison的<a href="https://blog.stylingandroid.com/material-part-4/">文章</a></p>

<p>我们写好以上代码，运行一下！截图如下：</p>

<p><img src="https://mzgreen.github.io/images/1/clipped.png" alt="" /></p>

<p>等一下，那是什么？你注意到没有？<code class="highlighter-rouge">Toolbar</code>把我们的列表挡住了。那是因为我们在<code class="highlighter-rouge">activity_main.xml</code>中设置<code class="highlighter-rouge">FrameLayout</code>为根布局。在开始的时候，我们提到过，这里有两种解决方案。第一张就是给<code class="highlighter-rouge">RecyclerView</code>设置paddingTop，其高度和<code class="highlighter-rouge">Toolbar</code>保持一致。但是还有一些细节需要注意，因为默认情况下，控件的绘制区域是在padding里面的，所以我们需要将其关闭，具体代码如下:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;android.support.v7.widget.recyclerview
	android:id="@+id/recyclerView"
    android:layout_width="match_parent"
    android:layout_height="match_parent"
    android:paddingtop="?attr/actionBarSize"
    android:cliptopadding="false"
&lt;/android.support.v7.widget.recyclerview&gt;
</code></pre></div></div>

<p>这样做，可以达到效果。但是，我想告诉你另一种实现方式-也许有点复杂，涉及增加了头的列表。</p>

<p>###为<code class="highlighter-rouge">RecyclerView</code>添加Header</p>

<p>首先，我们需要对Adapter做一些更改：</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>public class RecyclerAdapter extends RecyclerView.Adapter&lt;recyclerview.viewholder&gt; {
  //added view types
  private static final int TYPE_HEADER = 2;
  private static final int TYPE_ITEM = 1;

  private List&lt;string&gt; mItemList;

  public RecyclerAdapter(List&lt;string&gt; itemList) {
    mItemList = itemList;
  }

  //modified creating viewholder, so it creates appropriate holder for a given viewType
  @Override
  public RecyclerView.ViewHolder onCreateViewHolder(ViewGroup parent, int viewType) {
    Context context = parent.getContext();
    if (viewType == TYPE_ITEM) {
      final View view = LayoutInflater.from(context).inflate(R.layout.recycler_item, parent, false);
      return RecyclerItemViewHolder.newInstance(view);
    } else if (viewType == TYPE_HEADER) {
      final View view = LayoutInflater.from(context).inflate(R.layout.recycler_header, parent, false);
      return new RecyclerHeaderViewHolder(view);
    }
    throw new RuntimeException("There is no type that matches the type " + viewType + " + make sure your using types    correctly");
  }

  //modifed ViewHolder binding so it binds a correct View for the Adapter
  @Override
  public void onBindViewHolder(RecyclerView.ViewHolder viewHolder, int position) {
    if (!isPositionHeader(position)) {
      RecyclerItemViewHolder holder = (RecyclerItemViewHolder) viewHolder;
      String itemText = mItemList.get(position - 1); // we are taking header in to account so all of our items are correctly positioned
      holder.setItemText(itemText);
    }
  }

  //our old getItemCount()
  public int getBasicItemCount() {
    return mItemList == null ? 0 : mItemList.size();
  }

  //our new getItemCount() that includes header View
  @Override
  public int getItemCount() {
    return getBasicItemCount() + 1; // header
  }

  //added a method that returns viewType for a given position
  @Override
  public int getItemViewType(int position) {
    if (isPositionHeader(position)) {
    return TYPE_HEADER;
    }
    return TYPE_ITEM;
  }

  //added a method to check if given position is a header
  private boolean isPositionHeader(int position) {
    return position == 0;
  }

}
</code></pre></div></div>

<p>代码的具体思路如下：</p>

<ol>
  <li>我们需要为<code class="highlighter-rouge">Recycler</code>展示的不同的Item定义不同的Item Type。<code class="highlighter-rouge"> RecyclerView </code>是一个非常灵活的组件。当您希望为您的列表项目有不同的布局时，可以使用Item Type。而这正是我们想要做的，我们的第一个Item将是一个标题视图，不同于其他的项目(lines 3-4).</li>
  <li>我们需要告诉<code class="highlighter-rouge">Recycler</code>，返回哪个类型用于显示(lines 49-54).</li>
  <li>我们需要修改<code class="highlighter-rouge"> onCreateViewHolder </code>和<code class="highlighter-rouge"> onBindViewHolder </code>方法，根据type的不同TYPE_ITEM或者TYPE_HEAD，返回相应的item(lines 14-34).</li>
  <li>我们需要修改 <code class="highlighter-rouge">getItemCount()</code> - 返回的总数为数据集总数 + 1，因为我们还有一个Header（line 43-45）。现在，我们创建一个布局，并为其添加一个<code class="highlighter-rouge">ViewHolder</code>。</li>
</ol>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    &lt;view xmlns:android="http://schemas.android.com/apk/res/android"
    	android:layout_width="match_parent" 
        android:layout_height="?attr/actionBarSize"&gt;
    &lt;/view&gt;
</code></pre></div></div>

<p>布局很简单。重要的是要注意的是，它的高度需要是等于<code class="highlighter-rouge">Toolbar</code>的高度。这是<code class="highlighter-rouge"> viewholder </code>，也很简单：</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>public class RecyclerHeaderViewHolder extends RecyclerView.ViewHolder {
  public RecyclerHeaderViewHolder(View itemView) {
  	super(itemView);
  }
}
</code></pre></div></div>

<p><img src="https://mzgreen.github.io/images/1/clipping_fixed.png" alt="" />
好了，我们完成了！截图如上：</p>

<p>好多了，对吗？所以，综上所述，我们需要为RecyclerView增加了一个Header。它和Toolbar高度相同，它是一个空视图。toolbar刚好将其挡住，而其他的视图可以恰当好处的显示。接下来我们可以实现列表滚动时显示/隐藏视图。</p>

<p>###在列表滚动的时候显示/隐藏View</p>

<p>为了实现这个效果，我们将为<code class="highlighter-rouge">RecyclerView</code>创建一个类<code class="highlighter-rouge"> onscrolllistener</code>。</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>public abstract class HidingScrollListener extends RecyclerView.OnScrollListener {
  private static final int HIDE_THRESHOLD = 20;
  private int scrolledDistance = 0;
  private boolean controlsVisible = true;
  
  @Override
  public void onScrolled(RecyclerView recyclerView, int dx, int dy) {
	super.onScrolled(recyclerView, dx, dy);
    if (scrolledDistance &gt; HIDE_THRESHOLD &amp;&amp; controlsVisible) {
        onHide();
        controlsVisible = false;
        scrolledDistance = 0;
    } else if (scrolledDistance &lt; -HIDE_THRESHOLD &amp;&amp; !controlsVisible) {
    	onShow();
        controlsVisible = true;
        scrolledDistance = 0;
    }
    if((controlsVisible &amp;&amp; dy&gt;0) || (!controlsVisible &amp;&amp; dy&lt;0)) {
		scrolledDistance += dy;
	}
  }
  
  public abstract void onHide();
  public abstract void onShow();

}
</code></pre></div></div>

<p>真正起到作用的方法就是你现在看到的方法<code class="highlighter-rouge"> onscrolled() </code>方法。它的参数——dx，dy是水平和垂直滚动的量。其实他们是每次滑动的变化量，是两个前后事件的差，不是总滚动距离。</p>

<p>基本的实现思路如下：</p>

<ul>
  <li>
    <p>我们计算总的滚动距离（每一次滚动的总和）。但是，我们只关心View隐藏时的向上滑动或者View显示时的向下滑动，因为这些是我们所关心的场景。</p>

    <p>if((controlsVisible &amp;&amp; dy&gt;0) || (!controlsVisible &amp;&amp; dy&lt;0)) {
  	scrolledDistance += dy;
  }</p>
  </li>
  <li>
    <p>如果当滚动值超过某个阈值（你可以设置的值越大，需要滚动滚动更多的距离，才能看到显示/隐藏View的效果）。我们根据滚动的方向来显示/隐藏View（DY＞0意味着我们向下滚动，Dy＜0意味着我们滚动起来）。</p>

    <p>if (scrolledDistance &gt; HIDE_THRESHOLD &amp;&amp; controlsVisible) {
    onHide();
    controlsVisible = false;
    scrolledDistance = 0;
  } else if (scrolledDistance &lt; -HIDE_THRESHOLD &amp;&amp; !controlsVisible) {
    onShow();
    controlsVisible = true;
    scrolledDistance = 0;
  }</p>
  </li>
  <li>
    <p>事实上，我们不可能在Scroll Listener中显示/隐藏View，更为靠谱的做法是，将其抽象出来，调用show()/hide()方法，所以我们需要在回调中实现它们。</p>
  </li>
</ul>

<p>现在，我们需要给<code class="highlighter-rouge">RecyclerView</code>设置listener:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>private void initRecyclerView() {
  RecyclerView recyclerView = (RecyclerView) findViewById(R.id.recyclerView);
  recyclerView.setLayoutManager(new LinearLayoutManager(this));
  RecyclerAdapter recyclerAdapter = new RecyclerAdapter(createItemList());
  recyclerView.setAdapter(recyclerAdapter);
  //setting up our OnScrollListener
  recyclerView.setOnScrollListener(new HidingScrollListener() {
@Override
public void onHide() {
  hideViews();
}
@Override
public void onShow() {
  showViews();
}
  });
}
</code></pre></div></div>

<p>添加下面的方法，可以以动画的形式隐藏或显示View：</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>private void hideViews() {
  mToolbar.animate().translationY(-mToolbar.getHeight()).setInterpolator(new AccelerateInterpolator(2));
  
  FrameLayout.LayoutParams lp = (FrameLayout.LayoutParams) mFabButton.getLayoutParams();
  int fabBottomMargin = lp.bottomMargin;
  mFabButton.animate().translationY(mFabButton.getHeight()+fabBottomMargin).setInterpolator(new AccelerateInterpolator(2)).start();
}

private void showViews() {
  mToolbar.animate().translationY(0).setInterpolator(new DecelerateInterpolator(2));
  mFabButton.animate().translationY(0).setInterpolator(new DecelerateInterpolator(2)).start();
}
</code></pre></div></div>

<p>我们必须把margin作为隐藏Toolbar的参数，否则就不能完全隐藏Fab。</p>

<p>是时候看一下我们的应用程序的效果了！滚动屏幕截图</p>

<p><img src="https://mzgreen.github.io/images/1/broken_gif.gif" alt="" /></p>

<p>它看起来挺不错的，但是有一些小细节需要调整 - 如果你处于列表的顶部，而滑动隐藏的阈值设置的很小，那么即使在列表为空的情况下，你也可以隐藏<code class="highlighter-rouge">ToolBar</code>.幸运的是，这个问题很容易解决。我们需要做的是检测列表的第一项是否是可见的，从而根据实际情况调整<code class="highlighter-rouge">ToolBar</code>的显示/隐藏。</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>@Override
public void onScrolled(RecyclerView recyclerView, int dx, int dy) {
  super.onScrolled(recyclerView, dx, dy);
  
  int firstVisibleItem = ((LinearLayoutManager) recyclerView.getLayoutManager()).findFirstVisibleItemPosition();
  //show views if first item is first visible position and views are hidden
  if (firstVisibleItem == 0) {
if(!controlsVisible) {
  onShow();
  controlsVisible = true;
}
  } else {
if (scrolledDistance &gt; HIDE_THRESHOLD &amp;&amp; controlsVisible) {
  onHide();
  controlsVisible = false;
  scrolledDistance = 0;
} else if (scrolledDistance &lt; -HIDE_THRESHOLD &amp;&amp; !controlsVisible) {
  onShow();
  controlsVisible = true;
  scrolledDistance = 0;
}
  }
  
  if((controlsVisible &amp;&amp; dy&gt;0) || (!controlsVisible &amp;&amp; dy&lt;0)) {
scrolledDistance += dy;
  }
}
</code></pre></div></div>

<p>更改以后，当第一项是可见的时候，Header不会消失。接着向下滑的时候，其他的效果还是和之前的一样再次运行我们的项目，实际效果如下：</p>

<p><img src="https://mzgreen.github.io/images/1/demo_gif.gif" alt="" /></p>

<p>Yup! 现在看上去很不错哦！</p>

<p>这是我第一次写的博客，所以可能存在着一些错误，以后我会有所提高的。</p>

<p>And if you don’t want to use the method with adding a header, you can still use the second one with adding padding to the <code class="highlighter-rouge">RecyclerView</code>. Just add the padding and use <code class="highlighter-rouge">HidingScrollListener</code> that we’ve just created and it will work :)</p>

<p>如果你不想添加Head的方法，你仍然可以使用第二个加垫的<code class="highlighter-rouge"> recyclerview </code>。只要加入我们刚刚创建的，它将填充和使用<code class="highlighter-rouge"> hidingscrolllistener </code>：）</p>

<p>在下一个部分，我将告诉你如何做出像Google Play一样的效果。</p>

<p>如果你有什么疑问，你可以在下面的评论区评论。
###代码</p>

<p>这篇文章提到的所有源代码，你都可以在<a href="https://github.com/mzgreen/HideOnScrollExample">对应的Github仓库</a>上找到.</p>

<p>感谢<a href="https://twitter.com/froger_mcs">Mirek Stanek</a>作为这篇文章的内测读者.</p>

<ul>
  <li>Michał Z.</li>
</ul>

<p>如果你喜欢这篇文章，你可以<a href="https://twitter.com/intent/tweet?url=http://mzgreen.github.io/2015/02/15/How-to-hideshow-Toolbar-when-list-is-scroling(part1)/&amp;text=How%20to%20hide/show%20Toolbar%20when%20list%20is%20scroling%20(part%201)&amp;via=mzmzgreen">把他分享给你的关注者</a> 或者在<a href="https://twitter.com/mzmzgreen">Twitter</a>关注我!</p>


                <hr style="visibility: hidden;">

                <ul class="pager">
                    
                    <li class="previous">
                        <a href="/2015/10/17/Publish-with-Gradle-on-Bitbucket/" data-toggle="tooltip" data-placement="top" title="使用Gradle将项目发布到Bitbucket上">
                        Previous<br>
                        <span>使用Gradle将项目发布到Bitbucket上</span>
                        </a>
                    </li>
                    
                    
                    <li class="next">
                        <a href="/2016/01/07/Android-Reverse-Engineering-101-Part-1/" data-toggle="tooltip" data-placement="top" title="Android逆向工程101 – Part 1">
                        Next<br>
                        <span>Android逆向工程101 – Part 1</span>
                        </a>
                    </li>
                    
                </ul>


                <!--Gitalk评论start  -->
                
                <!-- 引入Gitalk评论插件  -->
                <link rel="stylesheet" href="https://unpkg.com/gitalk/dist/gitalk.css">
                <script src="https://unpkg.com/gitalk@latest/dist/gitalk.min.js"></script>
                <div id="gitalk-container"></div>
                <script type="text/javascript">
                    var gitalk = new Gitalk({
                    clientID: '0c25cf406e1d9c0165bb',
                    clientSecret: 'a9b973d400e04404eaebe31751812562019fc909',
                    repo: 'mijack.github.io',
                    owner: 'mijack',
                    admin: ['mijack'],
                    distractionFreeMode: true,
                    id: window.location.pathname,
                    });
                    gitalk.render('gitalk-container');
                </script>
                
                <!-- Gitalk end -->

                

            </div>  

    <!-- Side Catalog Container -->
        
            <div class="
                col-lg-2 col-lg-offset-0
                visible-lg-block
                sidebar-container
                catalog-container">
                <div class="side-catalog">
                    <hr class="hidden-sm hidden-xs">
                    <h5>
                        <a class="catalog-toggle" href="#">CATALOG</a>
                    </h5>
                    <ul class="catalog-body"></ul>
                </div>
            </div>
        

    <!-- Sidebar Container -->
            <div class="
                col-lg-8 col-lg-offset-2
                col-md-10 col-md-offset-1
                sidebar-container">

                <!-- Featured Tags -->
                
                <section>
                    <hr class="hidden-sm hidden-xs">
                    <h5><a href="/tags/">FEATURED TAGS</a></h5>
                    <div class="tags">
        				
                            
                				<a href="/tags/#Android" title="Android" rel="12">
                                    Android
                                </a>
                            
        				
                            
        				
                            
        				
                            
        				
                            
        				
                            
        				
                            
                				<a href="/tags/#逆向工程" title="逆向工程" rel="4">
                                    逆向工程
                                </a>
                            
        				
                            
        				
                            
        				
                            
        				
                            
        				
                            
        				
                            
        				
                            
        				
                            
        				
                            
        				
                            
        				
                            
        				
                            
        				
        			</div>
                </section>
                

                <!-- Friends Blog -->
                
                <hr>
                <h5>FRIENDS</h5>
                <ul class="list-inline">
                    
                        <li><a href="http://chih.me/">chih</a></li>
                    
                        <li><a href="https://buwenqi.github.io/">wenqi</a></li>
                    
                </ul>
                
            </div>
        </div>
    </div>
</article>






<!-- async load function -->
<script>
    function async(u, c) {
      var d = document, t = 'script',
          o = d.createElement(t),
          s = d.getElementsByTagName(t)[0];
      o.src = u;
      if (c) { o.addEventListener('load', function (e) { c(null, e); }, false); }
      s.parentNode.insertBefore(o, s);
    }
</script>
<!-- anchor-js, Doc:http://bryanbraun.github.io/anchorjs/ -->
<script>
    async("//cdnjs.cloudflare.com/ajax/libs/anchor-js/1.1.1/anchor.min.js",function(){
        anchors.options = {
          visible: 'always',
          placement: 'right',
          icon: '#'
        };
        anchors.add().remove('.intro-header h1').remove('.subheading').remove('.sidebar-container h5');
    })
</script>
<style>
    /* place left on bigger screen */
    @media all and (min-width: 800px) {
        .anchorjs-link{
            position: absolute;
            left: -0.75em;
            font-size: 1.1em;
            margin-top : -0.1em;
        }
    }
</style>


    <!-- Footer -->
<footer>
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <ul class="list-inline text-center">
                    
                    <li>
                        <a href="/feed.xml">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-rss fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                    
                    <!-- add jianshu add target = "_blank" to <a> by BY -->
                    
                    

                    <!-- add Weibo, Zhihu by Hux, add target = "_blank" to <a> by Hux -->
                    
                    <li>
                        <a target="_blank" href="https://www.zhihu.com/people/mijackstudio">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa  fa-stack-1x fa-inverse">知</i>
                            </span>
                        </a>
                    </li>
                    
                    


                    
                    
                    <li>
                        <a target="_blank" href="https://github.com/github">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-github fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                    
                    
                </ul>
                <p class="copyright text-muted">
                    Copyright &copy; Mi&Jack 2018
                    <br>
                    Theme on <a href="https://github.com/mijack/mijack.github.io.git">GitHub</a> |
                    <iframe
                        style="margin-left: 2px; margin-bottom:-5px;"
                        frameborder="0" scrolling="0" width="100px" height="20px"
                        src="https://ghbtns.com/github-btn.html?user=github&repo=github.github.io&type=star&count=true" >
                    </iframe>
                </p>
            </div>
        </div>
    </div>
</footer>

<!-- jQuery -->
<script src="/js/jquery.min.js "></script>

<!-- Bootstrap Core JavaScript -->
<script src="/js/bootstrap.min.js "></script>

<!-- Custom Theme JavaScript -->
<script src="/js/hux-blog.min.js "></script>

<!-- Service Worker -->

<script type="text/javascript">
    if(navigator.serviceWorker){
        // For security reasons, a service worker can only control the pages that are in the same directory level or below it. That's why we put sw.js at ROOT level.
        navigator.serviceWorker
            .register('/sw.js')
            .then((registration) => {console.log('Service Worker Registered. ', registration)})
            .catch((error) => {console.log('ServiceWorker registration failed: ', error)})
    }
</script>



<!-- async load function -->
<script>
    function async(u, c) {
      var d = document, t = 'script',
          o = d.createElement(t),
          s = d.getElementsByTagName(t)[0];
      o.src = u;
      if (c) { o.addEventListener('load', function (e) { c(null, e); }, false); }
      s.parentNode.insertBefore(o, s);
    }
</script>

<!-- 
     Because of the native support for backtick-style fenced code blocks 
     right within the Markdown is landed in Github Pages, 
     From V1.6, There is no need for Highlight.js, 
     so Huxblog drops it officially.

     - https://github.com/blog/2100-github-pages-now-faster-and-simpler-with-jekyll-3-0  
     - https://help.github.com/articles/creating-and-highlighting-code-blocks/ 
     - https://github.com/jneen/rouge/wiki/list-of-supported-languages-and-lexers   
-->
<!--
    <script>
        async("http://cdn.bootcss.com/highlight.js/8.6/highlight.min.js", function(){
            hljs.initHighlightingOnLoad();
        })
    </script>
    <link href="http://cdn.bootcss.com/highlight.js/8.6/styles/github.min.css" rel="stylesheet">
-->


<!-- jquery.tagcloud.js -->
<script>
    // only load tagcloud.js in tag.html
    if($('#tag_cloud').length !== 0){
        async('/js/jquery.tagcloud.js',function(){
            $.fn.tagcloud.defaults = {
                //size: {start: 1, end: 1, unit: 'em'},
                color: {start: '#bbbbee', end: '#0085a1'},
            };
            $('#tag_cloud a').tagcloud();
        })
    }
</script>

<!--fastClick.js -->
<script>
    async("//cdnjs.cloudflare.com/ajax/libs/fastclick/1.0.6/fastclick.min.js", function(){
        var $nav = document.querySelector("nav");
        if($nav) FastClick.attach($nav);
    })
</script>


<!-- Google Analytics -->

<script>
    // dynamic User by Hux
    var _gaId = 'UA-75651210-1';
    var _gaDomain = 'mijack.github.io';

    // Originial
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', _gaId, _gaDomain);
    ga('send', 'pageview');
</script>



<!-- Baidu Tongji -->




<!-- Side Catalog -->

<script type="text/javascript">
    function generateCatalog (selector) {
        var P = $('div.post-container'),a,n,t,l,i,c;
        a = P.find('h1,h2,h3,h4,h5,h6');
        a.each(function () {
            n = $(this).prop('tagName').toLowerCase();
            i = "#"+$(this).prop('id');
            t = $(this).text();
            c = $('<a href="'+i+'" rel="nofollow">'+t+'</a>');
            l = $('<li class="'+n+'_nav"></li>').append(c);
            $(selector).append(l);
        });
        return true;    
    }

    generateCatalog(".catalog-body");

    // toggle side catalog
    $(".catalog-toggle").click((function(e){
        e.preventDefault();
        $('.side-catalog').toggleClass("fold")
    }))

    /*
     * Doc: https://github.com/davist11/jQuery-One-Page-Nav
     * Fork by Hux to support padding
     */
    async("/js/jquery.nav.js", function () {
        $('.catalog-body').onePageNav({
            currentClass: "active",
            changeHash: !1,
            easing: "swing",
            filter: "",
            scrollSpeed: 700,
            scrollOffset: 0,
            scrollThreshold: .2,
            begin: null,
            end: null,
            scrollChange: null,
            padding: 80
        });
    });
</script>





<!-- Migrate from head to bottom, no longer block render and still work -->

</body>

</html>
