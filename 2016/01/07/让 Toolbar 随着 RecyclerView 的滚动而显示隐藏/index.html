<!DOCTYPE html>
<html lang="en">

<!-- Head tag -->
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="袁宇杰（Mi&amp;Jack）在 Github 上的个人博客">
    <meta name="keyword" content="null">
    <meta name="theme-color" content="#600090">
    <meta name="msapplication-navbutton-color" content="#600090">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="#600090">
    <link rel="shortcut icon" href="https://cdn4.iconfinder.com/data/icons/ionicons/512/icon-person-128.png">
    <link rel="alternate" type="application/atom+xml" title="江湖迈杰的博客" href="/atom.xml">
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/animate.css/3.5.2/animate.min.css">
    <link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.6.3/css/font-awesome.css">
    <title>
        
        让 Toolbar 随着 RecyclerView 的滚动而显示/隐藏｜Mi&amp;Jack&#39;s blog
        
    </title>

    <link rel="canonical" href="http://mijack.github.io/2016/01/07/让 Toolbar 随着 RecyclerView 的滚动而显示隐藏/">

    <!-- Bootstrap Core CSS -->
    <link rel="stylesheet" href="/css/bootstrap.min.css">

    <!-- Custom CSS -->
    <link rel="stylesheet" href="/css/blog-style.css">

    <!-- Pygments Github CSS -->
    <link rel="stylesheet" href="/css/syntax.css">
</head>

<style>

    header.intro-header {
        background-image: url('http://ohy7r8bgu.bkt.clouddn.com/background.jpg#博文默认的图片')
    }
</style>
<!-- hack iOS CSS :active style -->
<body ontouchstart="" class="animated fadeIn">
<!-- Navigation -->
<nav class="navbar navbar-default navbar-custom navbar-fixed-top " id="nav-top" data-ispost = "true" data-istags="false
" data-ishome = "false" >
    <div class="container-fluid">
        <!-- Brand and toggle get grouped for better mobile display -->
        <div class="navbar-header page-scroll">
            <button type="button" class="navbar-toggle">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand animated pulse" href="/">
                <span class="brand-logo">
                    江湖迈杰的博客
                </span>
                's Blog
            </a>
        </div>

        <!-- Collect the nav links, forms, and other content for toggling -->
        <!-- Known Issue, found by Hux:
            <nav>'s height woule be hold on by its content.
            so, when navbar scale out, the <nav> will cover tags.
            also mask any touch event of tags, unfortunately.
        -->
        <!-- /.navbar-collapse -->
        <div id="huxblog_navbar">
            <div class="navbar-collapse">
                <ul class="nav navbar-nav navbar-right">
                    <li>
                        <a href="/">Home</a>
                    </li>
					
                    
                        
                    
                        
							
                        <li>
                            <a href="/Tags/">Tags</a>
                        </li>
							
						
                    
					
					
                </ul>
            </div>
        </div>
    </div>
    <!-- /.container -->
</nav>
<script>
    // Drop Bootstarp low-performance Navbar
    // Use customize navbar with high-quality material design animation
    // in high-perf jank-free CSS3 implementation
//    var $body   = document.body;
    var $toggle = document.querySelector('.navbar-toggle');
    var $navbar = document.querySelector('#huxblog_navbar');
    var $collapse = document.querySelector('.navbar-collapse');

    $toggle.addEventListener('click', handleMagic)
    function handleMagic(e){
        if ($navbar.className.indexOf('in') > 0) {
        // CLOSE
            $navbar.className = " ";
            // wait until animation end.
            setTimeout(function(){
                // prevent frequently toggle
                if($navbar.className.indexOf('in') < 0) {
                    $collapse.style.height = "0px"
                }
            },400)
        }else{
        // OPEN
            $collapse.style.height = "auto"
            $navbar.className += " in";
        }
    }
</script>

<!-- Main Content -->

<!--only post-->


<img class="wechat-title-img"
     src="http://ohy7r8bgu.bkt.clouddn.com/background.jpg#博文默认的图片">


<style>
    
    header.intro-header {
        background-image: url('http://ohy7r8bgu.bkt.clouddn.com/background.jpg#博文默认的图片')
    }

    
</style>

<header class="intro-header">
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1 text-center">
                <div class="post-heading">
                    <h1>让 Toolbar 随着 RecyclerView 的滚动而显示/隐藏</h1>
                    
                    <span class="meta">
                         作者 Mi&Jack
                        <span>
                          日期 2016-01-07
                         </span>
                    </span>
                    <div class="tags text-center">
                        
                        <a class="tag" href="/tags/#Android"
                           title="Android">Android</a>
                        
                        <a class="tag" href="/tags/#开发"
                           title="开发">开发</a>
                        
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="post-title-haojen">
        <span>
            让 Toolbar 随着 RecyclerView 的滚动而显示/隐藏
        </span>
    </div>
</header>

<!-- Post Content -->
<article>
    <div class="container">
        <div class="row">
            <!-- Post Container -->
            <div class="col-lg-8 col-lg-offset-1 col-sm-9 post-container">
                <p>这篇文章是过时的，你应该跳到<a href="https://mzgreen.github.io/2015/06/23/How-to-hideshow-Toolbar-when-list-is-scrolling%28part3%29/" target="_blank" rel="external">第三部分 3</a>。</p>
<p>在这篇文章中，我们将看到如何实现像Google+ 应用程序一样，当列表下滑时，Toolbar和FAB（包括其他的View）隐藏；当列表上滑时，Toolbar和FAB（包括其他的View）显示的效果；这种效果在<a href="http://android-developers.blogspot.com/2014/10/material-design-on-android-checklist.html" target="_blank" rel="external">Material Design Checklist</a>提到过.</p>
<blockquote>
<p>“在一些场景下，当屏幕向上滚动时，app bar将会从屏幕上移除，留出更多的空间供内容。相反，当向上滚动时，app bar应再次显示。</p>
</blockquote>
<p>我们的目标效果如下图所示：</p>
<p><img src="https://mzgreen.github.io/images/1/demo_gif.gif" alt=""></p>
<p>我们将使用<code>RecyclerView</code>为我们的List，当然，你也可以选择其他滚动控件（例如<code>ListView</code>，但它就意味着更多的编码。现在，我有两种具体的实现方法：</p>
<ol>
<li>给List设置padding</li>
<li>给List添加一个headr</li>
</ol>
<p>我只是决定执行第二个方案，因为我发现在如何给<code>RecyclerView</code>添加header这一问题上，有很多需要注意的地方，这是一个很好的机会去解决他们。<br>我也将简要描述第一个。</p>
<p>###我们开始吧</p>
<p>我们要创建一个工程，并添加如下依赖：<br><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">dependencies &#123;</div><div class="line">  compile fileTree(dir: &apos;libs&apos;, include: [&apos;*.jar&apos;])</div><div class="line">  compile &apos;com.android.support:appcompat-v7:21.0.3&apos;</div><div class="line">  compile &quot;com.android.support:recyclerview-v7:21.0.0&quot;</div><div class="line">  compile &apos;com.android.support:cardview-v7:21.0.3&apos;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>现在我们应该定义<code>style.xml</code>，我们的应用程序将使用Material的主题,但我们不使用<code>ActionBar</code>（取而代之是<code>Toolbar</code>）：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">&lt;style name=&quot;AppTheme&quot; parent=&quot;Theme.AppCompat.Light.NoActionBar&quot;&gt;</div><div class="line">  &lt;item name=&quot;colorPrimary&quot;&gt;@color/color_primary&lt;/item&gt;</div><div class="line">  &lt;item name=&quot;colorPrimaryDark&quot;&gt;@color/color_primary_dark&lt;/item&gt;</div><div class="line">&lt;/style&gt;</div></pre></td></tr></table></figure>
<p>接下来是创建<code>Activity</code>的布局：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">&lt;FrameLayout </div><div class="line">	xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;</div><div class="line">    android:layout_width=&quot;match_parent&quot;</div><div class="line">    android:layout_height=&quot;match_parent&quot;&gt;</div><div class="line"></div><div class="line">	&lt;android.support.v7.widget.RecyclerView</div><div class="line">    	android:id=&quot;@+id/recyclerView&quot;</div><div class="line">        android:layout_width=&quot;match_parent&quot;</div><div class="line">        android:layout_height=&quot;match_parent&quot;&gt;</div><div class="line"></div><div class="line">		&lt;android.support.v7.widget.Toolbar</div><div class="line">        	android:id=&quot;@+id/toolbar&quot;</div><div class="line">        	android:layout_width=&quot;match_parent&quot;</div><div class="line">            android:layout_height=&quot;?attr/actionBarSize&quot;</div><div class="line">            android:background=&quot;?attr/colorPrimary&quot;&gt;</div><div class="line"></div><div class="line">			&lt;ImageButton</div><div class="line">                android:id=&quot;@+id/fabButton&quot;</div><div class="line">                android:layout_width=&quot;56dp&quot;</div><div class="line">                android:layout_height=&quot;56dp&quot;</div><div class="line">                android:layout_gravity=&quot;bottom|right&quot;</div><div class="line">                android:layout_marginbottom=&quot;16dp&quot;</div><div class="line">                android:layout_marginright=&quot;16dp&quot;</div><div class="line">                android:background=&quot;@drawable/fab_background&quot;</div><div class="line">                android:src=&quot;@drawable/ic_favorite_outline_white_24dp&quot;</div><div class="line">                android:contentdescription=&quot;@null&quot;&gt;</div><div class="line">            &lt;/ImageButton&gt;</div><div class="line">        &lt;/android.support.v7.widget.Toolbar&gt;</div><div class="line">    &lt;/android.support.v7.widget.RecyclerView&gt;</div><div class="line">&lt;/FrameLayout&gt;</div></pre></td></tr></table></figure>
<p>这是一个简单的布局，只有<code>RecyclerView</code>、<code>Toolbar</code>以及作为FAB的<code>ImageButton</code>。我们需要把它们放在一个<code>FrameLayout</code>，因为这样可以达到<code>Toolbar</code>覆盖<code>RecyclerView</code>的效果。如果我们不这样做，当我们隐藏Toolbar的时候在列表的上方将会有一个空白的空间。</p>
<p>让我们来看看<code>MainActiviy</code>的代码吧：<br><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">public class MainActivity extends ActionBarActivity &#123;</div><div class="line">  private Toolbar mToolbar;</div><div class="line">  private ImageButton mFabButton;</div><div class="line"></div><div class="line">  @Override</div><div class="line">  protected void onCreate(Bundle savedInstanceState) &#123;</div><div class="line">    super.onCreate(savedInstanceState);</div><div class="line">    setContentView(R.layout.activity_main);</div><div class="line">    initToolbar();</div><div class="line">    mFabButton = (ImageButton) findViewById(R.id.fabButton);</div><div class="line">    initRecyclerView();</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  private void initToolbar() &#123;</div><div class="line">    mToolbar = (Toolbar) findViewById(R.id.toolbar);</div><div class="line">    setSupportActionBar(mToolbar);</div><div class="line">    setTitle(getString(R.string.app_name));</div><div class="line">    mToolbar.setTitleTextColor(getResources().getColor(android.R.color.white));</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  private void initRecyclerView() &#123;</div><div class="line">    RecyclerView recyclerView = (RecyclerView) findViewById(R.id.recyclerView);</div><div class="line">    recyclerView.setLayoutManager(new LinearLayoutManager(this));</div><div class="line">    RecyclerAdapter recyclerAdapter = new RecyclerAdapter(createItemList());</div><div class="line">    recyclerView.setAdapter(recyclerAdapter);</div><div class="line">  &#125;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>正如你所看到的，这是一个十分简单的类，它只实现onCreate()方法，做了以下事情：</p>
<ol>
<li>初始化 <code>Toolbar</code></li>
<li>获取FAB</li>
<li>初始化 <code>RecyclerView</code></li>
</ol>
<p>现在我们将为<code>RecylerView</code>创建adapter。在这之前，我们需要添加list item的布局：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</div><div class="line">&lt;android.support.v7.widget.cardview</div><div class="line">	xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;</div><div class="line">    xmlns:card_view=&quot;http://schemas.android.com/apk/res-auto&quot;</div><div class="line">    android:layout_width=&quot;match_parent&quot;</div><div class="line">    android:layout_height=&quot;wrap_content&quot;</div><div class="line">    android:layout_gravity=&quot;center&quot;</div><div class="line">    android:layout_margin=&quot;8dp&quot;</div><div class="line">    card_view:cardcornerradius=&quot;4dp&quot;&gt;</div><div class="line"></div><div class="line">    &lt;TextView</div><div class="line">    	android:id=&quot;@+id/itemTextView&quot;</div><div class="line">    	android:layout_width=&quot;match_parent&quot;</div><div class="line">        android:layout_height=&quot;?attr/listPreferredItemHeight&quot;</div><div class="line">        android:gravity=&quot;center_vertical&quot;</div><div class="line">        android:padding=&quot;8dp&quot;</div><div class="line">        style=&quot;@style/Base.TextAppearance.AppCompat.Body2&quot;&gt;</div><div class="line">    &lt;/TextView&gt;</div><div class="line">&lt;/android.support.v7.widget.cardview&gt;</div></pre></td></tr></table></figure>
<p>对应的<code>ViewHolder</code>如下:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">public class RecyclerItemViewHolder extends RecyclerView.ViewHolder &#123;</div><div class="line">  private final TextView mItemTextView;</div><div class="line"></div><div class="line">  public RecyclerItemViewHolder(final View parent, TextView itemTextView) &#123;</div><div class="line">    super(parent);</div><div class="line">    mItemTextView = itemTextView;</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  public static RecyclerItemViewHolder newInstance(View parent) &#123;</div><div class="line">    TextView itemTextView = (TextView) parent.findViewById(R.id.itemTextView);</div><div class="line">    return new RecyclerItemViewHolder(parent, itemTextView);</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  public void setItemText(CharSequence text) &#123;</div><div class="line">    mItemTextView.setText(text);</div><div class="line">  &#125;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>我们的列表用于呈现带有文本的卡片 - 简单吧！</p>
<p>现在，我们看一下<code>RecyclerAdapter</code>的代码：<br><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">public class RecyclerAdapter extends RecyclerView.Adapter&lt;recyclerview.viewholder&gt; &#123;</div><div class="line">  private List&lt;string&gt; mItemList;</div><div class="line"></div><div class="line">  public RecyclerAdapter(List&lt;string&gt; itemList) &#123;</div><div class="line">    mItemList = itemList;</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  @Override</div><div class="line">  public RecyclerView.ViewHolder onCreateViewHolder(ViewGroup parent, int viewType) &#123;</div><div class="line">    final View view = LayoutInflater.from(parent.getContext()).inflate(R.layout.recycler_item, parent, false);</div><div class="line">    return RecyclerItemViewHolder.newInstance(view);</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  @Override</div><div class="line">  public void onBindViewHolder(RecyclerView.ViewHolder viewHolder, int position) &#123;</div><div class="line">    RecyclerItemViewHolder holder = (RecyclerItemViewHolder) viewHolder;</div><div class="line">    String itemText = mItemList.get(position);</div><div class="line">    holder.setItemText(itemText);</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  @Override</div><div class="line">  public int getItemCount() &#123;</div><div class="line">    return mItemList == null ? 0 : mItemList.size();</div><div class="line">  &#125;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>这个是<code>RecyclerView.Adapter</code>的基本实现。并没有什么特殊的东西。如果，你想深入了解 <code>RecyclerView</code>,我建议你好好的阅读一下Mark Allison的<a href="https://blog.stylingandroid.com/material-part-4/" target="_blank" rel="external">文章</a></p>
<p>我们写好以上代码，运行一下！截图如下：</p>
<p><img src="https://mzgreen.github.io/images/1/clipped.png" alt=""></p>
<p>等一下，那是什么？你注意到没有？<code>Toolbar</code>把我们的列表挡住了。那是因为我们在<code>activity_main.xml</code>中设置<code>FrameLayout</code>为根布局。在开始的时候，我们提到过，这里有两种解决方案。第一张就是给<code>RecyclerView</code>设置paddingTop，其高度和<code>Toolbar</code>保持一致。但是还有一些细节需要注意，因为默认情况下，控件的绘制区域是在padding里面的，所以我们需要将其关闭，具体代码如下:</p>
<pre><code>&lt;android.support.v7.widget.recyclerview
    android:id=&quot;@+id/recyclerView&quot;
    android:layout_width=&quot;match_parent&quot;
    android:layout_height=&quot;match_parent&quot;
    android:paddingtop=&quot;?attr/actionBarSize&quot;
    android:cliptopadding=&quot;false&quot;
&lt;/android.support.v7.widget.recyclerview&gt;
</code></pre><p>这样做，可以达到效果。但是，我想告诉你另一种实现方式-也许有点复杂，涉及增加了头的列表。</p>
<p>###为<code>RecyclerView</code>添加Header</p>
<p>首先，我们需要对Adapter做一些更改：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">public class RecyclerAdapter extends RecyclerView.Adapter&lt;recyclerview.viewholder&gt; &#123;</div><div class="line">  //added view types</div><div class="line">  private static final int TYPE_HEADER = 2;</div><div class="line">  private static final int TYPE_ITEM = 1;</div><div class="line"></div><div class="line">  private List&lt;string&gt; mItemList;</div><div class="line"></div><div class="line">  public RecyclerAdapter(List&lt;string&gt; itemList) &#123;</div><div class="line">    mItemList = itemList;</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  //modified creating viewholder, so it creates appropriate holder for a given viewType</div><div class="line">  @Override</div><div class="line">  public RecyclerView.ViewHolder onCreateViewHolder(ViewGroup parent, int viewType) &#123;</div><div class="line">    Context context = parent.getContext();</div><div class="line">    if (viewType == TYPE_ITEM) &#123;</div><div class="line">      final View view = LayoutInflater.from(context).inflate(R.layout.recycler_item, parent, false);</div><div class="line">      return RecyclerItemViewHolder.newInstance(view);</div><div class="line">    &#125; else if (viewType == TYPE_HEADER) &#123;</div><div class="line">      final View view = LayoutInflater.from(context).inflate(R.layout.recycler_header, parent, false);</div><div class="line">      return new RecyclerHeaderViewHolder(view);</div><div class="line">    &#125;</div><div class="line">    throw new RuntimeException(&quot;There is no type that matches the type &quot; + viewType + &quot; + make sure your using types    correctly&quot;);</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  //modifed ViewHolder binding so it binds a correct View for the Adapter</div><div class="line">  @Override</div><div class="line">  public void onBindViewHolder(RecyclerView.ViewHolder viewHolder, int position) &#123;</div><div class="line">    if (!isPositionHeader(position)) &#123;</div><div class="line">      RecyclerItemViewHolder holder = (RecyclerItemViewHolder) viewHolder;</div><div class="line">      String itemText = mItemList.get(position - 1); // we are taking header in to account so all of our items are correctly positioned</div><div class="line">      holder.setItemText(itemText);</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  //our old getItemCount()</div><div class="line">  public int getBasicItemCount() &#123;</div><div class="line">    return mItemList == null ? 0 : mItemList.size();</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  //our new getItemCount() that includes header View</div><div class="line">  @Override</div><div class="line">  public int getItemCount() &#123;</div><div class="line">    return getBasicItemCount() + 1; // header</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  //added a method that returns viewType for a given position</div><div class="line">  @Override</div><div class="line">  public int getItemViewType(int position) &#123;</div><div class="line">    if (isPositionHeader(position)) &#123;</div><div class="line">    return TYPE_HEADER;</div><div class="line">    &#125;</div><div class="line">    return TYPE_ITEM;</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  //added a method to check if given position is a header</div><div class="line">  private boolean isPositionHeader(int position) &#123;</div><div class="line">    return position == 0;</div><div class="line">  &#125;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>代码的具体思路如下：</p>
<ol>
<li>我们需要为<code>Recycler</code>展示的不同的Item定义不同的Item Type。<code>RecyclerView</code>是一个非常灵活的组件。当您希望为您的列表项目有不同的布局时，可以使用Item Type。而这正是我们想要做的，我们的第一个Item将是一个标题视图，不同于其他的项目(lines 3-4).</li>
<li>我们需要告诉<code>Recycler</code>，返回哪个类型用于显示(lines 49-54).</li>
<li>我们需要修改<code>onCreateViewHolder</code>和<code>onBindViewHolder</code>方法，根据type的不同TYPE_ITEM或者TYPE_HEAD，返回相应的item(lines 14-34).</li>
<li>我们需要修改 <code>getItemCount()</code> - 返回的总数为数据集总数 + 1，因为我们还有一个Header（line 43-45）。现在，我们创建一个布局，并为其添加一个<code>ViewHolder</code>。</li>
</ol>
<figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">&lt;view xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;</div><div class="line">	android:layout_width=&quot;match_parent&quot; </div><div class="line">    android:layout_height=&quot;?attr/actionBarSize&quot;&gt;</div><div class="line">&lt;/view&gt;</div></pre></td></tr></table></figure>
<p>布局很简单。重要的是要注意的是，它的高度需要是等于<code>Toolbar</code>的高度。这是<code>viewholder</code>，也很简单：</p>
<pre><code>public class RecyclerHeaderViewHolder extends RecyclerView.ViewHolder {
  public RecyclerHeaderViewHolder(View itemView) {
      super(itemView);
  }
}
</code></pre><p><img src="https://mzgreen.github.io/images/1/clipping_fixed.png" alt=""><br>好了，我们完成了！截图如上：</p>
<p>好多了，对吗？所以，综上所述，我们需要为RecyclerView增加了一个Header。它和Toolbar高度相同，它是一个空视图。toolbar刚好将其挡住，而其他的视图可以恰当好处的显示。接下来我们可以实现列表滚动时显示/隐藏视图。</p>
<p>###在列表滚动的时候显示/隐藏View</p>
<p>为了实现这个效果，我们将为<code>RecyclerView</code>创建一个类<code>onscrolllistener</code>。</p>
<pre><code>public abstract class HidingScrollListener extends RecyclerView.OnScrollListener {
  private static final int HIDE_THRESHOLD = 20;
  private int scrolledDistance = 0;
  private boolean controlsVisible = true;

  @Override
  public void onScrolled(RecyclerView recyclerView, int dx, int dy) {
    super.onScrolled(recyclerView, dx, dy);
    if (scrolledDistance &gt; HIDE_THRESHOLD &amp;&amp; controlsVisible) {
        onHide();
        controlsVisible = false;
        scrolledDistance = 0;
    } else if (scrolledDistance &lt; -HIDE_THRESHOLD &amp;&amp; !controlsVisible) {
        onShow();
        controlsVisible = true;
        scrolledDistance = 0;
    }
    if((controlsVisible &amp;&amp; dy&gt;0) || (!controlsVisible &amp;&amp; dy&lt;0)) {
        scrolledDistance += dy;
    }
  }

  public abstract void onHide();
  public abstract void onShow();

}
</code></pre><p>真正起到作用的方法就是你现在看到的方法<code>onscrolled()</code>方法。它的参数——dx，dy是水平和垂直滚动的量。其实他们是每次滑动的变化量，是两个前后事件的差，不是总滚动距离。</p>
<p>基本的实现思路如下：</p>
<ul>
<li><p>我们计算总的滚动距离（每一次滚动的总和）。但是，我们只关心View隐藏时的向上滑动或者View显示时的向下滑动，因为这些是我们所关心的场景。</p>
<p>  if((controlsVisible &amp;&amp; dy&gt;0) || (!controlsVisible &amp;&amp; dy&lt;0)) {</p>
<pre><code>scrolledDistance += dy;
</code></pre><p>  }</p>
</li>
</ul>
<ul>
<li><p>如果当滚动值超过某个阈值（你可以设置的值越大，需要滚动滚动更多的距离，才能看到显示/隐藏View的效果）。我们根据滚动的方向来显示/隐藏View（DY＞0意味着我们向下滚动，Dy＜0意味着我们滚动起来）。</p>
<p>  if (scrolledDistance &gt; HIDE_THRESHOLD &amp;&amp; controlsVisible) {</p>
<pre><code>onHide();
controlsVisible = false;
scrolledDistance = 0;
</code></pre><p>  } else if (scrolledDistance &lt; -HIDE_THRESHOLD &amp;&amp; !controlsVisible) {</p>
<pre><code>onShow();
controlsVisible = true;
scrolledDistance = 0;
</code></pre><p>  }</p>
</li>
<li><p>事实上，我们不可能在Scroll Listener中显示/隐藏View，更为靠谱的做法是，将其抽象出来，调用show()/hide()方法，所以我们需要在回调中实现它们。</p>
</li>
</ul>
<p>现在，我们需要给<code>RecyclerView</code>设置listener:</p>
<pre><code>private void initRecyclerView() {
  RecyclerView recyclerView = (RecyclerView) findViewById(R.id.recyclerView);
  recyclerView.setLayoutManager(new LinearLayoutManager(this));
  RecyclerAdapter recyclerAdapter = new RecyclerAdapter(createItemList());
  recyclerView.setAdapter(recyclerAdapter);
  //setting up our OnScrollListener
  recyclerView.setOnScrollListener(new HidingScrollListener() {
@Override
public void onHide() {
  hideViews();
}
@Override
public void onShow() {
  showViews();
}
  });
}
</code></pre><p>添加下面的方法，可以以动画的形式隐藏或显示View：</p>
<pre><code>private void hideViews() {
  mToolbar.animate().translationY(-mToolbar.getHeight()).setInterpolator(new AccelerateInterpolator(2));

  FrameLayout.LayoutParams lp = (FrameLayout.LayoutParams) mFabButton.getLayoutParams();
  int fabBottomMargin = lp.bottomMargin;
  mFabButton.animate().translationY(mFabButton.getHeight()+fabBottomMargin).setInterpolator(new AccelerateInterpolator(2)).start();
}

private void showViews() {
  mToolbar.animate().translationY(0).setInterpolator(new DecelerateInterpolator(2));
  mFabButton.animate().translationY(0).setInterpolator(new DecelerateInterpolator(2)).start();
}
</code></pre><p>我们必须把margin作为隐藏Toolbar的参数，否则就不能完全隐藏Fab。</p>
<p>是时候看一下我们的应用程序的效果了！滚动屏幕截图</p>
<p><img src="https://mzgreen.github.io/images/1/broken_gif.gif" alt=""></p>
<p>它看起来挺不错的，但是有一些小细节需要调整 - 如果你处于列表的顶部，而滑动隐藏的阈值设置的很小，那么即使在列表为空的情况下，你也可以隐藏<code>ToolBar</code>.幸运的是，这个问题很容易解决。我们需要做的是检测列表的第一项是否是可见的，从而根据实际情况调整<code>ToolBar</code>的显示/隐藏。</p>
<pre><code>@Override
public void onScrolled(RecyclerView recyclerView, int dx, int dy) {
  super.onScrolled(recyclerView, dx, dy);

  int firstVisibleItem = ((LinearLayoutManager) recyclerView.getLayoutManager()).findFirstVisibleItemPosition();
  //show views if first item is first visible position and views are hidden
  if (firstVisibleItem == 0) {
if(!controlsVisible) {
  onShow();
  controlsVisible = true;
}
  } else {
if (scrolledDistance &gt; HIDE_THRESHOLD &amp;&amp; controlsVisible) {
  onHide();
  controlsVisible = false;
  scrolledDistance = 0;
} else if (scrolledDistance &lt; -HIDE_THRESHOLD &amp;&amp; !controlsVisible) {
  onShow();
  controlsVisible = true;
  scrolledDistance = 0;
}
  }

  if((controlsVisible &amp;&amp; dy&gt;0) || (!controlsVisible &amp;&amp; dy&lt;0)) {
scrolledDistance += dy;
  }
}
</code></pre><p>更改以后，当第一项是可见的时候，Header不会消失。接着向下滑的时候，其他的效果还是和之前的一样再次运行我们的项目，实际效果如下：</p>
<p><img src="https://mzgreen.github.io/images/1/demo_gif.gif" alt=""></p>
<p>Yup! 现在看上去很不错哦！</p>
<p>这是我第一次写的博客，所以可能存在着一些错误，以后我会有所提高的。</p>
<p>And if you don’t want to use the method with adding a header, you can still use the second one with adding padding to the <code>RecyclerView</code>. Just add the padding and use <code>HidingScrollListener</code> that we’ve just created and it will work :)</p>
<p>如果你不想添加Head的方法，你仍然可以使用第二个加垫的<code>recyclerview</code>。只要加入我们刚刚创建的，它将填充和使用<code>hidingscrolllistener</code>：）</p>
<p>在下一个部分，我将告诉你如何做出像Google Play一样的效果。</p>
<p>如果你有什么疑问，你可以在下面的评论区评论。</p>
<p>###代码</p>
<p>这篇文章提到的所有源代码，你都可以在<a href="https://github.com/mzgreen/HideOnScrollExample" target="_blank" rel="external">对应的Github仓库</a>上找到.</p>
<p>感谢<a href="https://twitter.com/froger_mcs" target="_blank" rel="external">Mirek Stanek</a>作为这篇文章的内测读者.</p>
<ul>
<li>Michał Z.</li>
</ul>
<p>如果你喜欢这篇文章，你可以<a href="https://twitter.com/intent/tweet?url=http://mzgreen.github.io/2015/02/15/How-to-hideshow-Toolbar-when-list-is-scroling(part1" target="_blank" rel="external">把他分享给你的关注者</a>/&amp;text=How%20to%20hide/show%20Toolbar%20when%20list%20is%20scroling%20(part%201)&amp;via=mzmzgreen) 或者在<a href="https://twitter.com/mzmzgreen" target="_blank" rel="external">Twitter</a>关注我!</p>

                <hr>
                

                <ul class="pager">
                    
                    <li class="previous">
                        <a href="/2016/01/07/Android-Reverse-Engineering-101-Part-1/" data-toggle="tooltip" data-placement="top"
                           title="Android逆向工程101 – Part 1">&larr; Previous Post</a>
                    </li>
                    
                    
                    <li class="next">
                        <a href="/2015/10/17/Publish-with-Gradle-on-Bitbucket/" data-toggle="tooltip" data-placement="top"
                           title="使用Gradle将项目发布到Bitbucket上">Next Post &rarr;</a>
                    </li>
                    
                </ul>

                

                

            </div>

            <div class="hidden-xs col-sm-3 toc-col">
                <div class="toc-wrap">
                    
                </div>
            </div>
        </div>

        <div class="row">
            <!-- Sidebar Container -->

            <div class="
                col-lg-8 col-lg-offset-2
                col-md-10 col-md-offset-1
                sidebar-container">

                <!-- Featured Tags -->
                
                <section>
                    <!-- no hr -->
                    <h5 class="text-center">
                        <a href="/tags/">FEATURED TAGS</a>
                    </h5>
                    <div class="tags">
                        
                        <a class="tag" href="/tags/#Android"
                           title="Android">Android</a>
                        
                        <a class="tag" href="/tags/#开发"
                           title="开发">开发</a>
                        
                    </div>
                </section>
                

                <!-- Friends Blog -->
                
                <div style="margin-top: 20px;">
                    <h5 class="text-center">FRIENDS</h5>
                    <ul class="list-inline text-center">
                        
                        <li><a href="http://chih.me">chih</a></li>
                        
                        <li><a href="https://buwenqi.github.io">wenqi</a></li>
                        
                    </ul>
                </div>
                
            </div>
        </div>

    </div>
</article>






<!-- Footer -->
<!-- Footer -->
<footer>
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1 text-center">
                <br>
                <ul class="list-inline text-center">
                
                
                
                    <li>
                        <a target="_blank" href="https://www.zhihu.com/people/mijackstudio">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa  fa-stack-1x fa-inverse">知</i>
                            </span>
                        </a>
                    </li>
                

                
                    <li>
                        <a target="_blank" href="http://weibo.com/mijackstudio">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-weibo fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                

                

                
                    <li>
                        <a target="_blank"  href="https://github.com/mijack">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-github fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                

                

                </ul>
                <p class="copyright text-muted">
                    Copyright &copy; 江湖迈杰的博客 2018
                    <br>
                    <span id="busuanzi_container_site_pv" style="font-size: 12px;">PV: <span id="busuanzi_value_site_pv"></span> Times</span>
                    <br>
                    Theme by <a href="https://haojen.github.io/">Haojen Ma</a>
                </p>

            </div>
        </div>
    </div>
</footer>

<!-- jQuery -->
<script src="/js/jquery.min.js"></script>

<!-- Bootstrap Core JavaScript -->
<script src="/js/bootstrap.min.js"></script>

<!-- Custom Theme JavaScript -->
<script src="/js/blog.js"></script>

<!-- async load function -->
<script>
    function async(u, c) {
      var d = document, t = 'script',
          o = d.createElement(t),
          s = d.getElementsByTagName(t)[0];
      o.src = u;
      if (c) { o.addEventListener('load', function (e) { c(null, e); }, false); }
      s.parentNode.insertBefore(o, s);
    }
</script>

<!-- jquery.tagcloud.js -->
<script>
    // only load tagcloud.js in tag.html
    if($('#tag_cloud').length !== 0){
        async("http://mijack.github.io/js/jquery.tagcloud.js",function(){
            $.fn.tagcloud.defaults = {
                //size: {start: 1, end: 1, unit: 'em'},
                color: {start: '#bbbbee', end: '#0085a1'},
            };
            $('#tag_cloud a').tagcloud();
        })
    }
</script>

<!--fastClick.js -->
<script>
    async("//cdn.bootcss.com/fastclick/1.0.6/fastclick.min.js", function(){
        var $nav = document.querySelector("nav");
        if($nav) FastClick.attach($nav);
    })
</script>

<!-- Google Analytics -->


<script>
    // dynamic User by Hux
    var _gaId = 'UA-75651210- 1';
    var _gaDomain = 'auto';
    // Originial
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
                (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
            m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
    ga('create', _gaId, _gaDomain);
    ga('send', 'pageview');
</script>


<!-- Baidu Tongji -->


<!-- swiftype -->
<script type="text/javascript">
  (function(w,d,t,u,n,s,e){w['SwiftypeObject']=n;w[n]=w[n]||function(){
  (w[n].q=w[n].q||[]).push(arguments);};s=d.createElement(t);
  e=d.getElementsByTagName(t)[0];s.async=1;s.src=u;e.parentNode.insertBefore(s,e);
  })(window,document,'script','//s.swiftypecdn.com/install/v2/st.js','_st');

  _st('install','null','2.0.0');
</script>

<script async src="//dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>

<!--wechat title img-->
<img class="wechat-title-img" src="https://avatars.githubusercontent.com/u/4158061?v=3">
</body>

</html>
