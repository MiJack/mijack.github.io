<!DOCTYPE html>
<html lang="en">

<!-- Head tag -->
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="袁宇杰（Mi&amp;Jack）在 Github 上的个人博客">
    <meta name="keyword" content="null">
    <meta name="theme-color" content="#600090">
    <meta name="msapplication-navbutton-color" content="#600090">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="#600090">
    <link rel="shortcut icon" href="https://cdn4.iconfinder.com/data/icons/ionicons/512/icon-person-128.png">
    <link rel="alternate" type="application/atom+xml" title="江湖迈杰的博客" href="/atom.xml">
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/animate.css/3.5.2/animate.min.css">
    <link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.6.3/css/font-awesome.css">
    <title>
        
        30分钟搭建一个android的私有Maven仓库｜Mi&amp;Jack&#39;s blog
        
    </title>

    <link rel="canonical" href="http://mijack.github.io/2015/09/03/30分钟搭建一个android的私有Maven仓库/">

    <!-- Bootstrap Core CSS -->
    <link rel="stylesheet" href="/css/bootstrap.min.css">

    <!-- Custom CSS -->
    <link rel="stylesheet" href="/css/blog-style.css">

    <!-- Pygments Github CSS -->
    <link rel="stylesheet" href="/css/syntax.css">
</head>

<style>

    header.intro-header {
        background-image: url('http://ohy7r8bgu.bkt.clouddn.com/background.jpg#博文默认的图片')
    }
</style>
<!-- hack iOS CSS :active style -->
<body ontouchstart="" class="animated fadeIn">
<!-- Navigation -->
<nav class="navbar navbar-default navbar-custom navbar-fixed-top " id="nav-top" data-ispost = "true" data-istags="false
" data-ishome = "false" >
    <div class="container-fluid">
        <!-- Brand and toggle get grouped for better mobile display -->
        <div class="navbar-header page-scroll">
            <button type="button" class="navbar-toggle">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand animated pulse" href="/">
                <span class="brand-logo">
                    江湖迈杰的博客
                </span>
                's Blog
            </a>
        </div>

        <!-- Collect the nav links, forms, and other content for toggling -->
        <!-- Known Issue, found by Hux:
            <nav>'s height woule be hold on by its content.
            so, when navbar scale out, the <nav> will cover tags.
            also mask any touch event of tags, unfortunately.
        -->
        <!-- /.navbar-collapse -->
        <div id="huxblog_navbar">
            <div class="navbar-collapse">
                <ul class="nav navbar-nav navbar-right">
                    <li>
                        <a href="/">Home</a>
                    </li>
					
                    
                        
                    
                        
							
                        <li>
                            <a href="/Tags/">Tags</a>
                        </li>
							
						
                    
					
					
                </ul>
            </div>
        </div>
    </div>
    <!-- /.container -->
</nav>
<script>
    // Drop Bootstarp low-performance Navbar
    // Use customize navbar with high-quality material design animation
    // in high-perf jank-free CSS3 implementation
//    var $body   = document.body;
    var $toggle = document.querySelector('.navbar-toggle');
    var $navbar = document.querySelector('#huxblog_navbar');
    var $collapse = document.querySelector('.navbar-collapse');

    $toggle.addEventListener('click', handleMagic)
    function handleMagic(e){
        if ($navbar.className.indexOf('in') > 0) {
        // CLOSE
            $navbar.className = " ";
            // wait until animation end.
            setTimeout(function(){
                // prevent frequently toggle
                if($navbar.className.indexOf('in') < 0) {
                    $collapse.style.height = "0px"
                }
            },400)
        }else{
        // OPEN
            $collapse.style.height = "auto"
            $navbar.className += " in";
        }
    }
</script>

<!-- Main Content -->

<!--only post-->


<img class="wechat-title-img"
     src="http://ohy7r8bgu.bkt.clouddn.com/background.jpg#博文默认的图片">


<style>
    
    header.intro-header {
        background-image: url('http://ohy7r8bgu.bkt.clouddn.com/background.jpg#博文默认的图片')
    }

    
</style>

<header class="intro-header">
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1 text-center">
                <div class="post-heading">
                    <h1>30分钟搭建一个android的私有Maven仓库</h1>
                    
                    <span class="meta">
                         作者 Mi&Jack
                        <span>
                          日期 2015-09-03
                         </span>
                    </span>
                    <div class="tags text-center">
                        
                        <a class="tag" href="/tags/#Android"
                           title="Android">Android</a>
                        
                        <a class="tag" href="/tags/#Maven"
                           title="Maven">Maven</a>
                        
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="post-title-haojen">
        <span>
            30分钟搭建一个android的私有Maven仓库
        </span>
    </div>
</header>

<!-- Post Content -->
<article>
    <div class="container">
        <div class="row">
            <!-- Post Container -->
            <div class="col-lg-8 col-lg-offset-1 col-sm-9 post-container">
                <blockquote>
<ul>
<li>原文链接 : <a href="原文url">A PRIVATE MAVEN REPOSITORY FOR ANDROID IN 30 MIN</a></li>
<li>原文作者 : <a href="http://jeroenmols.github.io/blog/" target="_blank" rel="external">JEROEN MOLS</a></li>
<li>译文出自 : <a href="http://www.devtf.cn" target="_blank" rel="external">开发技术前线 www.devtf.cn。未经允许，不得转载!</a></li>
<li>译者 : <a href="https://github.com/mijack" target="_blank" rel="external">MiJack</a></li>
<li>校对者: <a href="https://github.com/mijack" target="_blank" rel="external">MiJack</a>  </li>
<li>状态 :  已完成</li>
</ul>
</blockquote>
<p><img src="http://jeroenmols.github.io/img/blog/artifactory.png" alt=""></p>
<p>建立你自己的Maven库和上传artifacts，这是一个相当艰巨的任务。最近,我在这方面获得了一定的经验，希望和大家分享：通过<a href="http://www.jfrog.com/open-source/" target="_blank" rel="external">Artifactory</a>建立Maven库并使用Gradle自动上传artifact。</p>
<p>在不到30分钟，你将有一个可以运作的私有Maven库,通过配置gradle的buildscripts自动上传artifact。</p>
<p>请注意，这里提出的有关内容包括但不仅局限于安卓，他实际的使用范围更广。</p>
<p><strong>设置一个库管理器</strong></p>
<p>首先，我们需要确保我们有一个Maven库可以用于上传我们的artifact。根据<a href="https://maven.apache.org/repository-management.html" target="_blank" rel="external">Maven</a>,你应该使用一个库管理工具：</p>
<blockquote>
<p>最佳实践-使用库管理器<br>库管理器是一个专门的服务器应用程序，用于管理二进制组件的库。The usage of a repository manager is considered an essential best practice for any significant usage of Maven.</p>
</blockquote>
<p><strong>为什么是ARTIFACTORY?</strong></p>
<p>虽然有一些其他的选项可供选择，我个人选择<a href="http://www.jfrog.com/open-source/" target="_blank" rel="external">artifactory</a>因为：</p>
<ul>
<li>清晰且有吸引力的用户界面</li>
<li>超快速配置</li>
<li>Gradle插件</li>
<li>用户访问控制</li>
<li>自由和开放来源</li>
</ul>
<p>更多信息请查看<a href="https://maven.apache.org/repository-management.html" target="_blank" rel="external">alternatives</a>, checkout<a href="http://www.jfrog.com/blog/artifactory-vs-nexus-integration-matrix/" target="_blank" rel="external">feature comparison matrix</a>或者回顾 <a href="https://www.jfrog.com/confluence/display/RTF/Artifactory+Comparison+Matrix" target="_blank" rel="external">Artifactory的特性</a>.</p>
<p><strong>确定你安装了JAVA SDK 8</strong></p>
<p>在你开始之前，请确定你现在已经安装了Java 8，否则Artifactory将无法运行。你可以通过<code>java -version</code>这个命令获取Java的版本:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">$ java -version</div><div class="line">java version &quot;1.8.0_51&quot;</div><div class="line">Java(TM) SE Runtime Environment (build 1.8.0_51-b16)</div><div class="line">Java HotSpot(TM) 64-Bit Server VM (build 25.51-b03, mixed mode)</div></pre></td></tr></table></figure>
<p>如果输出版本小于1.8.X，你应该<a href="http://www.oracle.com/technetwork/java/javase/downloads/jdk8-downloads-2133151.html" target="_blank" rel="external">下载</a>和安装一个新的Java SDK。<br>请注意，如果你没有Java 8的错误，看起来有点诡异：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">Aug 05, 2015 9:29:31 AM org.apache.catalina.core.StandardContext startInternal</div><div class="line">SEVERE: One or more listeners failed to start. Full details will be found in the appropriate container log file</div></pre></td></tr></table></figure>
<p><strong>安装 artifactory</strong></p>
<p>这一步，简单的难以置信。只需下载最新版本的<a href="http://www.jfrog.com/open-source/" target="_blank" rel="external">artifactory</a>，解压文件，然后运行与你的平台对应的<code>artifactory</code>可执行文件即可。</p>
<p><a href="http://img.youtube.com/vi/aa4YBDUDWy0/0.jpg" target="_blank" rel="external">youtube</a></p>
<p>通过访问<code>http://localhost:8081/artifactory/</code>，你就可以知道是否安装正确。在该页面，你可以体验到artifactory的一些特性。现在，不要担心所有的设置，我们稍后将配置我们所需要的设置。</p>
<p><strong>配置Gradle自动上传Android artifact</strong></p>
<p>通过配置一个新的Gradle任务，我们可以上传一个简单的文件。</p>
<p>在最上层的<code>build.gradle</code>文件（这里指文件路径）添加一个关于Artifactory Gradle 插件的引用：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">buildscript &#123;</div><div class="line">    dependencies &#123;</div><div class="line">        classpath &quot;org.jfrog.buildinfo:build-info-extractor-gradle:3.1.1&quot;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>接下来，在你的库中，我们将需要两个新的插件：一个准备Maven artifact <code>maven-publish</code>，另一个上传archives到artifactory <code>com.jfrog.artifactory</code>：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">apply plugin: &apos;com.jfrog.artifactory&apos;</div><div class="line">apply plugin: &apos;maven-publish&apos;</div></pre></td></tr></table></figure>
<p>每一个Maven artifact都由以下三个参数确定：</p>
<ul>
<li>artifactId：库的名称</li>
<li>groupId：通常库的包名</li>
<li>version：区别同一artifact的不同版本</li>
</ul>
<p>一般的，我们将在build.gradle文件定义最后两个变量。<br><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">def packageName = &apos;com.jeroenmols.awesomelibrary&apos;</div><div class="line">def libraryVersion = &apos;1.0.0&apos;</div></pre></td></tr></table></figure></p>
<p><code>artifactId</code>需要和<code>assemblerelease</code>任务输出的文件名相匹配。因此我们要<a href="https://stackoverflow.com/questions/26936812/renaming-modules-in-android-studio" target="_blank" rel="external">重命名库模块</a>或<a href="https://stackoverflow.com/questions/24728591/how-to-set-name-of-aar-output-from-gradle" target="_blank" rel="external">指定输出文件名</a>。我个人比较喜欢第一种方法，可以通过下面这种方式得到<code>artifactId</code>：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">project.getName() // the ArtifactId</div></pre></td></tr></table></figure>
<p>现在我们需要配置<code>maven-publish</code>，这样就知道哪一个artifactory将发布到Artifactory。我们的目的，我们是引用<code>`***-release.aar</code>文件，他是由<code>assemblerelease</code>任务生成。请注意，我们可以通过更改库项目名称来预测这个名称：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">publishing &#123;</div><div class="line">    publications &#123;</div><div class="line">        aar(MavenPublication) &#123;</div><div class="line">            groupId packageName</div><div class="line">            version = libraryVersion</div><div class="line">            artifactId project.getName()</div><div class="line"></div><div class="line">            // Tell maven to prepare the generated &quot;* .aar&quot; file for publishing</div><div class="line">            artifact(&quot;$buildDir/outputs/aar/$&#123;project.getName()&#125;-release.aar&quot;)</div><div class="line">      &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>最后，我们需要配置<code>com.jfrog.artifactory</code> 插件,来指定artifact发布到的库。为简单起见，我们将上传一个artifact到本地运行的Artifactory实例(<code>http://localhost:8081/artifactory</code>),默认放在<code>libs-release-local</code>库中。请注意，在本例中，用户名<code>admin</code>，密码<code>password</code>是硬编码的形式。我们希望以后有一个更好的解决方案。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">artifactory &#123;</div><div class="line">    contextUrl = &apos;http://localhost:8081/artifactory&apos;</div><div class="line">    publish &#123;</div><div class="line">        repository &#123;</div><div class="line">            // The Artifactory repository key to publish to</div><div class="line">            repoKey = &apos;libs-release-local&apos;</div><div class="line"></div><div class="line">            username = &quot;admin&quot;</div><div class="line">            password = &quot;password&quot;</div><div class="line">        &#125;</div><div class="line">        defaults &#123;</div><div class="line">            // Tell the Artifactory Plugin which artifacts should be published to Artifactory.</div><div class="line">            publications(&apos;aar&apos;)</div><div class="line">            publishArtifacts = true</div><div class="line"></div><div class="line">            // Properties to be attached to the published artifacts.</div><div class="line">            properties = [&apos;qa.level&apos;: &apos;basic&apos;, &apos;dev.team&apos;: &apos;core&apos;]</div><div class="line">            // Publish generated POM files to Artifactory (true by default)</div><div class="line">            publishPom = true</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p><strong>部署 ARTIFACTS</strong></p>
<p>现在，我们通过配置Gradle的buildscripts，运行以下命令轻松部署artifactory：<br><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">gradle assembleRelease artifactoryPublish</div></pre></td></tr></table></figure></p>
<p>注意，我们在调用调用的实际<code>artifactoryPublish</code>任务前，会先调用<code>assembleRelease</code>，这取决于我们在上一节定义的方式。</p>
<p>你可以通过管理员凭据登陆<code>localhost:8081</code>，知道有没有上传成功。</p>
<p><img src="http://jeroenmols.github.io/img/blog/artifactory_screenshot.png" alt=""></p>
<p><strong>使用ARTIFACTS</strong></p>
<p>为了保证另一个项目也可以引用这个artifact，我们需要在根目录下的<code>build.gradle</code>文件中，把我们的仓库信息添加到仓库列表中。<br><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">allprojects &#123;</div><div class="line">    repositories &#123;</div><div class="line">        maven &#123; url &quot;http://localhost:8081/artifactory/libs-release-local&quot; &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>然后，我们只需要在主工程的<code>build.gradle</code>文件中添加artifact作为依赖就可以了：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">dependencies &#123;</div><div class="line">    compile &apos;com.jeroenmols.awesomelibrary:1.0.0&apos;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p><strong>WRAP-UP</strong><br><strong>总结</strong></p>
<p>恭喜你！你完成了利用gradle生成和上传你的artifact 带Maven仓库。</p>
<p>在 <a href="http://jeroenmols.github.io/blog/2015/08/13/artifactory2/" target="_blank" rel="external">下一篇博客</a> ，我将继续学习一下几点:</p>
<ul>
<li>库项目的依赖</li>
<li>配置你自己的仓库</li>
<li>使用权限管理</li>
</ul>
<p>记得更改<code>build.gradle</code> 里的账号、密码</p>
<p>我已经上传了一份 <a href="https://github.com/JeroenMols/ArtifactoryExample" target="_blank" rel="external">例子</a> 到github供你参考。</p>

                <hr>
                

                <ul class="pager">
                    
                    <li class="previous">
                        <a href="/2015/10/07/Android上MVP的介绍/" data-toggle="tooltip" data-placement="top"
                           title="MVP在Android平台上的应用">&larr; Previous Post</a>
                    </li>
                    
                    
                    <li class="next">
                        <a href="/1977/01/01/demo/" data-toggle="tooltip" data-placement="top"
                           title="hello world">Next Post &rarr;</a>
                    </li>
                    
                </ul>

                

                

            </div>

            <div class="hidden-xs col-sm-3 toc-col">
                <div class="toc-wrap">
                    
                </div>
            </div>
        </div>

        <div class="row">
            <!-- Sidebar Container -->

            <div class="
                col-lg-8 col-lg-offset-2
                col-md-10 col-md-offset-1
                sidebar-container">

                <!-- Featured Tags -->
                
                <section>
                    <!-- no hr -->
                    <h5 class="text-center">
                        <a href="/tags/">FEATURED TAGS</a>
                    </h5>
                    <div class="tags">
                        
                        <a class="tag" href="/tags/#Android"
                           title="Android">Android</a>
                        
                        <a class="tag" href="/tags/#Maven"
                           title="Maven">Maven</a>
                        
                    </div>
                </section>
                

                <!-- Friends Blog -->
                
                <div style="margin-top: 20px;">
                    <h5 class="text-center">FRIENDS</h5>
                    <ul class="list-inline text-center">
                        
                        <li><a href="http://chih.me">chih</a></li>
                        
                        <li><a href="https://buwenqi.github.io">wenqi</a></li>
                        
                    </ul>
                </div>
                
            </div>
        </div>

    </div>
</article>






<!-- Footer -->
<!-- Footer -->
<footer>
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1 text-center">
                <br>
                <ul class="list-inline text-center">
                
                
                
                    <li>
                        <a target="_blank" href="https://www.zhihu.com/people/mijackstudio">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa  fa-stack-1x fa-inverse">知</i>
                            </span>
                        </a>
                    </li>
                

                
                    <li>
                        <a target="_blank" href="http://weibo.com/mijackstudio">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-weibo fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                

                

                
                    <li>
                        <a target="_blank"  href="https://github.com/mijack">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-github fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                

                

                </ul>
                <p class="copyright text-muted">
                    Copyright &copy; 江湖迈杰的博客 2017
                    <br>
                    <span id="busuanzi_container_site_pv" style="font-size: 12px;">PV: <span id="busuanzi_value_site_pv"></span> Times</span>
                    <br>
                    Theme by <a href="https://haojen.github.io/">Haojen Ma</a>
                </p>

            </div>
        </div>
    </div>
</footer>

<!-- jQuery -->
<script src="/js/jquery.min.js"></script>

<!-- Bootstrap Core JavaScript -->
<script src="/js/bootstrap.min.js"></script>

<!-- Custom Theme JavaScript -->
<script src="/js/blog.js"></script>

<!-- async load function -->
<script>
    function async(u, c) {
      var d = document, t = 'script',
          o = d.createElement(t),
          s = d.getElementsByTagName(t)[0];
      o.src = u;
      if (c) { o.addEventListener('load', function (e) { c(null, e); }, false); }
      s.parentNode.insertBefore(o, s);
    }
</script>

<!-- jquery.tagcloud.js -->
<script>
    // only load tagcloud.js in tag.html
    if($('#tag_cloud').length !== 0){
        async("http://mijack.github.io/js/jquery.tagcloud.js",function(){
            $.fn.tagcloud.defaults = {
                //size: {start: 1, end: 1, unit: 'em'},
                color: {start: '#bbbbee', end: '#0085a1'},
            };
            $('#tag_cloud a').tagcloud();
        })
    }
</script>

<!--fastClick.js -->
<script>
    async("//cdn.bootcss.com/fastclick/1.0.6/fastclick.min.js", function(){
        var $nav = document.querySelector("nav");
        if($nav) FastClick.attach($nav);
    })
</script>

<!-- Google Analytics -->


<script>
    // dynamic User by Hux
    var _gaId = 'UA-75651210- 1';
    var _gaDomain = 'auto';
    // Originial
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
                (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
            m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
    ga('create', _gaId, _gaDomain);
    ga('send', 'pageview');
</script>


<!-- Baidu Tongji -->


<!-- swiftype -->
<script type="text/javascript">
  (function(w,d,t,u,n,s,e){w['SwiftypeObject']=n;w[n]=w[n]||function(){
  (w[n].q=w[n].q||[]).push(arguments);};s=d.createElement(t);
  e=d.getElementsByTagName(t)[0];s.async=1;s.src=u;e.parentNode.insertBefore(s,e);
  })(window,document,'script','//s.swiftypecdn.com/install/v2/st.js','_st');

  _st('install','null','2.0.0');
</script>

<script async src="//dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>

<!--wechat title img-->
<img class="wechat-title-img" src="https://avatars.githubusercontent.com/u/4158061?v=3">
</body>

</html>
